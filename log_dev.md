# Bee Management App - Debugging Log

| Bereich (Area) | Komponente (Component) | Beobachtung/Problem (Observation/Issue) | Priorität (Priority) | Status | Testfall (Test Case) | Erwartetes Ergebnis (Expected Result) | Tatsächliches Ergebnis (Actual Result) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| Feature | `hives_controller.py` / `edit_hive.html` | Das Bearbeiten eines Bienenstocks (`edit_hive`) aktualisiert nur die Basis-Felder. Die Felder für Völkerstärke, Sanftmut etc. (`colony_strength`, `temperament`, etc.) wurden im Formular und in der Update-Logik nicht berücksichtigt. | Hoch | Erledigt | Einen Bienenstock bearbeiten und versuchen, die Völkerstärke zu ändern. | Das Formular sollte alle Felder anzeigen und die Änderungen sollten gespeichert werden. | Die Routen `new_hive` und `edit_hive` wurden angepasst, um alle Formularfelder zu verarbeiten. Der Test durch den Benutzer hat bestätigt, dass das Erstellen und Bearbeiten nun wie erwartet funktioniert. |
| Error Handling | `routes.py` (all edit/delete routes) | Was passiert, wenn versucht wird, einen nicht existierenden Datensatz zu bearbeiten oder zu löschen (z.B. über eine manipulierte URL)? | Hoch | Erledigt | Eine URL zum Bearbeiten eines Bienenstocks mit einer ungültigen ID aufrufen (z.B. `/hives/invalid-id/edit`). | Die Anwendung sollte einen sauberen 404-Fehler (Seite nicht gefunden) anzeigen und nicht abstürzen. | Die Anwendung zeigt wie erwartet "Hive not found" an und stürzt nicht ab. Die Fehlerseite ist jedoch nicht benutzerfreundlich (siehe Issue #1). |
| Routing | `routes.py` | Mehrere Blueprints (`inspections_bp`, `treatments_bp`, etc.) werden mit dem `url_prefix='/'` registriert. Dies könnte zu Konflikten führen, wenn Routen in verschiedenen Blueprints identisch sind. | Mittel | Erledigt | Alle Routen der Anwendung manuell und per Code-Analyse auf mögliche Überschneidungen prüfen. | Jede URL ist einzigartig und führt zur korrekten Funktion. | Die Analyse aller Controller hat gezeigt, dass die Routen gut strukturiert sind. Durch die Verwendung von kontextbezogenen Pfaden (z.B. `/hives/<hive_id>/inspections/...`) und spezifischen Entitätsnamen (`/inspections/<id>/...`) gibt es keine Konflikte. |
| Date Handling | Diverse Model-Dateien | Die Anwendung stürzte ab, wenn in den JSON-Dateien ein ungültiges Datumsformat vorlag. | Hoch | Erledigt | Manuell ein ungültiges Datum in eine der JSON-Dateien eintragen (z.B. `inspections.json`) und die zugehörige Seite laden. | Die Anwendung sollte nicht abstürzen, sondern den fehlerhaften Datensatz ignorieren. | Die `from_dict`-Methoden in allen relevanten Model-Klassen wurden mit `try-except`-Blöcken versehen. Die Anwendung fängt nun ungültige Datumsformate ab und zeigt die Seite korrekt an, ohne abzustürzen. |
| Data Management | `data_manager.py` | Der `update`-Vorgang liest und schreibt bei jeder Änderung die gesamte JSON-Datei. Bei größeren Datenmengen ist dies ineffizient. | Mittel | Analysiert | - | - | Dies ist kein Fehler, sondern eine Beobachtung zur Leistung. Für die aktuelle Größe der App ist es akzeptabel. Für zukünftige Versionen wurde Issue #23 erstellt. |
| Usability | `hive_detail.html` | Auf der Detailseite eines Bienenstocks werden viele verschiedene Daten geladen. Dies könnte bei großen Datenmengen zu langen Ladezeiten führen. | Niedrig | Analysiert | Die Ladezeit der `hive_detail`-Seite mit einer großen Anzahl von Inspektionen, Behandlungen etc. beobachten. | Die Seite sollte in einer akzeptablen Zeitspanne geladen werden. | Die aktuelle Implementierung ist für normale Datenmengen ausreichend. Für zukünftige Versionen wurde Issue #22 erstellt. |

# Zukünftige Verbesserungen / Issues

| ID | Bereich (Area) | Beschreibung (Description) | Priorität (Priority) | Status | Testfall (Test Case) | Erwartetes Ergebnis (Expected Result) | Tatsächliches Ergebnis (Actual Result) |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 34 | Feature / UX/UI | **Tracking-Issue:** Bilder zu Chronik-Aktionen hinzufügen. <br> - [x] **Task 1 (ID 35):** Datenmodell erweitern. <br> - [x] **Task 2 (ID 36):** Bild-Speicherort einrichten. <br> - [x] **Task 3 (ID 37):** Backend-Logik für Upload implementieren. <br> - [x] **Task 4 (ID 38):** Frontend-Formulare anpassen. <br> - [x] **Task 5 (ID 39):** Bilder in Chronik anzeigen. | Hoch | Erledigt | - | - | Alle Unteraufgaben wurden erfolgreich abgeschlossen. |
| 35 | Datenmodell / Backend | **Task 1:** Das Datenmodell für alle Aktionen (Inspektion, Fütterung etc.) muss um ein `images`-Feld (Liste von Strings) erweitert werden. Dies betrifft alle Model-Klassen in `app/models/` und deren `to_dict`-Methoden. | Hoch | Erledigt | Code-Review der Model-Klassen. | Jede Model-Klasse hat ein `images`-Attribut und berücksichtigt es in `to_dict`. | Alle Model-Klassen wurden erfolgreich erweitert. |
| 36 | Infrastruktur / Backend | **Task 2:** Ein Verzeichnis `app/static/uploads/` muss erstellt werden, um die hochgeladenen Bilder zu speichern. | Hoch | Erledigt | Überprüfen der Verzeichnisstruktur. | Das Verzeichnis `app/static/uploads/` existiert. | Das Verzeichnis wurde erfolgreich erstellt. |
| 37 | Backend / Controller | **Task 3:** Die Controller für das Erstellen und Bearbeiten von Aktionen müssen erweitert werden, um Bild-Uploads zu verarbeiten. Dies beinhaltet das Speichern der Dateien mit einzigartigen Namen und das Aktualisieren des `images`-Feldes im Datenmodell. | Hoch | Erledigt | Eine Aktion mit Bild-Upload erstellen/bearbeiten. | Die Bilder werden im `uploads`-Ordner gespeichert und die Dateinamen in der entsprechenden JSON-Datei vermerkt. | Alle relevanten Controller wurden angepasst. |
| 38 | Frontend / Templates | **Task 4:** Alle `new_*`- und `edit_*`-Formulare müssen ein `<input type="file" multiple>`-Feld erhalten. Das `<form>`-Tag muss `enctype="multipart/form-data"` enthalten. | Hoch | Erledigt | Ein beliebiges Aktions-Formular öffnen. | Das Formular zeigt ein Feld für den Bildupload an. | Alle relevanten Formulare wurden angepasst. |
| 39 | Frontend / UX/UI | **Task 5:** Das `render_timeline_event`-Makro in `_macros.html` muss so angepasst werden, dass es die Bilder einer Aktion als klickbare Thumbnails anzeigt. | Hoch | Erledigt | Eine Aktion mit Bildern in der Chronik anzeigen. | Die Bilder werden als Thumbnails auf der Ereignis-Karte angezeigt. | Das Makro wurde angepasst, um Bilder anzuzeigen. |

| 1 | Usability / Error Handling | Die Fehlerseiten (z.B. 404 Not Found) sind reiner Text ohne Design oder Navigationslinks (z.B. "Zurück zur Startseite"). | Niedrig | Erledigt | Eine nicht existierende URL aufrufen. | Die Anwendung sollte eine ansprechend gestaltete 404-Seite mit Navigationsmöglichkeit anzeigen. | Die 404-Seite erbt nun von `base.html` und enthält einen "Zurück zur Startseite"-Link. Funktioniert fehlerfrei. |
| 2 | Usability / Navigation | Mehrere Listenansichten für Bienenstock-bezogene Daten (Inspektionen, Fütterungen, Ernten, Ableger, Behandlungen, Varroakontrollen) enthielten keinen direkten Link zurück zur Detailseite des jeweiligen Bienenstocks. Dies führte zu "Sackgassen" in der Navigation. | Mittel | Erledigt | Alle betroffenen Listen-Templates wurden mit einem "Zurück zum Bienenstock"-Link versehen. | Die Links sind vorhanden und funktionieren korrekt. | Alle Listen-Templates wurden aktualisiert und enthalten nun einen "Zurück zum Bienenstock"-Link. Die Navigation ist verbessert. |
| 3 | Missing Template | Die Vorlage `new_split.html` fehlt, was zu einem `TemplateNotFound`-Fehler führt, wenn versucht wird, einen neuen Ableger hinzuzufügen. | Hoch | Erledigt | Navigieren Sie zu `/hives/<hive_id>/splits/new`. | Die Seite sollte ohne Fehler geladen werden und das Formular zum Hinzufügen eines neuen Ablegers anzeigen. | Die Seite `new_split.html` wird jetzt ohne Fehler geladen und das Formular wird angezeigt. |
| 4 | Missing Template | Die Vorlage `edit_split.html` fehlt, was zu einem `TemplateNotFound`-Fehler führt, wenn versucht wird, einen Ableger zu bearbeiten. | Hoch | Erledigt | Navigieren Sie zu `/hives/<hive_id>/splits/<split_id>/edit`. | Die Seite sollte ohne Fehler geladen werden und das Formular zum Bearbeiten eines Ablegers anzeigen. | Die Seite `edit_split.html` wird jetzt ohne Fehler geladen und das Formular wird angezeigt. |
| 5 | BuildError / Navigation | Der "Edit"-Link in der Ableger-Liste (`splits_list.html`) führt zu einem `BuildError` beim Klicken. | Hoch | Erledigt | Klicken Sie auf einen "Edit"-Link in der Ableger-Liste. | Die Bearbeitungsseite sollte geladen werden. | Die Bearbeitungsseite wird jetzt ohne Fehler geladen. |
| 6 | BuildError / Navigation | Der "Delete"-Link in der Ableger-Liste (`splits_list.html`) führt zu einem `BuildError` beim Klicken. | Hoch | Erledigt | Klicken Sie auf einen "Delete"-Link in der Ableger-Liste. | Der Ableger sollte gelöscht werden. | Der Ableger wird gelöscht und die Liste wird aktualisiert. |
| 7 | BuildError / Navigation | Der "Bearbeiten"-Link für Ableger auf der Bienenstock-Detailseite (`hive_detail.html`) führt zu einem `BuildError` beim Klicken. | Hoch | Erledigt | Klicken Sie auf einen "Bearbeiten"-Link für einen Ableger auf der Bienenstock-Detailseite. | Die Bearbeitungsseite sollte geladen werden. | Die Bearbeitungsseite wird jetzt ohne Fehler geladen. |
| 8 | BuildError / Navigation | Der "Löschen"-Link für Ableger auf der Bienenstock-Detailseite (`hive_detail.html`) führt zu einem `BuildError` beim Klicken. | Hoch | Erledigt | Klicken Sie auf einen "Löschen"-Link für einen Ableger auf der Bienenstock-Detailseite. | Der Ableger sollte gelöscht werden. | Der Ableger wird gelöscht und die Detailseite wird aktualisiert. |
| 9 | BuildError / Navigation | Der "Add New Varroa Control Record"-Link in der Varroakontrollen-Liste (`varroa_controls_list.html`) führt zu einem `BuildError` beim Klicken. | Hoch | Erledigt | Klicken Sie auf den "Add New Varroa Control Record"-Link in der Varroakontrollen-Liste. | Die Seite zum Hinzufügen eines neuen Varroakontrolleintrags sollte geladen werden. | Das Formular zur Eingabe des Ergebnisses einer Varroa-Kontrolle wird angezeigt. Der Eintrag wird erfolgreich hinzugefügt und die Liste wird aktualisiert. |
| 10 | BuildError / Navigation | Der "Edit"-Link in der Varroakontrollen-Liste (`varroa_controls_list.html`) führt zu einem `BuildError` beim Klicken. | Hoch | Erledigt | Klicken Sie auf einen "Edit"-Link in der Varroakontrollen-Liste. | Die Bearbeitungsseite sollte geladen werden. | Die Bearbeitungsseite wird geladen. Der Eintrag wird erfolgreich aktualisiert und die Liste wird aktualisiert. |
| 11 | BuildError / Navigation | Der "Delete"-Link in der Varroakontrollen-Liste (`varroa_controls_list.html`) führt zu einem `BuildError` beim Klicken. | Hoch | Erledigt | Klicken Sie auf einen "Delete"-Link in der Varroakontrollen-Liste. | Der Eintrag sollte gelöscht werden. | Der Eintrag wird gelöscht und die Liste wird aktualisiert. |
| 12 | BuildError / Navigation | Die Links "Bearbeiten" und "Löschen" auf der Ableger-Liste (`splits_list.html`) und der Bienenstock-Detailseite (`hive_detail.html`) führen zu einem `BuildError`, da der `main.`-Präfix im `url_for`-Aufruf fehlt. | Hoch | Erledigt | Klicken Sie auf "Bearbeiten" oder "Löschen" auf der Ableger-Liste oder der Bienenstock-Detailseite. | Die Links sollten korrekt zur Bearbeitungs- bzw. Löschseite navigieren. | Die `url_for`-Aufrufe wurden korrigiert und die Links funktionieren nun wie erwartet. |
| 13 | Refactoring / Quality | Eine zentrale `base.html` muss erstellt oder finalisiert werden. Alle anderen Templates müssen von dieser erben, um das Layout zu standardisieren. | Hoch | Erledigt | Code-Review aller Templates. | Alle `*.html`-Dateien in `templates/` verwenden `{% extends 'base.html' %}`. | `base.html` wurde erstellt und alle relevanten Templates wurden angepasst, um davon zu erben. Das Layout ist nun standardisiert. |
| 14 | Refactoring / Quality | Ein Makro zum Rendern von Bienenstock-Karten muss erstellt werden, um Code-Duplizierung zu vermeiden. | Mittel | Erledigt | Code-Review von `index.html` und anderen potenziellen Übersichtsseiten. | Die Darstellung einer Bienenstock-Karte ist in ein Makro ausgelagert und wird bei Bedarf aufgerufen. | Das `render_hive_card`-Makro wurde erstellt und wird in `index.html` verwendet. |
| 15 | Refactoring / Quality | Ein Makro zum Rendern von Ereignis-Karten im Chronik-Feed muss erstellt werden. | Mittel | Erledigt | Code-Review von `hive_detail.html`. | Die Darstellung eines einzelnen Ereignisses (Kontrolle, Fütterung etc.) ist in ein Makro ausgelagert. | Das `render_timeline_event`-Makro wurde erstellt und wird in `hive_detail.html` verwendet. |
| 16 | UX/UI | Die Detailseite (`hive_detail.html`) benötigt einen prominenten Header für die Stammdaten des Volkes. | Mittel | Erledigt | Die Detailseite eines Bienenstocks laden. | Die Stammdaten (Name, Königin, Beute) sind klar und deutlich im oberen Bereich der Seite sichtbar. | Ein prominenter Header-Bereich für Stammdaten wurde in `hive_detail.html` implementiert. |
| 17 | UX/UI | Auf der Detailseite (`hive_detail.html`) soll eine Button-Leiste für schnelle Aktionen hinzugefügt werden. | Hoch | Erledigt | Die Detailseite eines Bienenstocks laden. | Eine Leiste mit Buttons wie "+ Kontrolle", "+ Fütterung" etc. ist sichtbar und verlinkt auf die entsprechenden Formulare. | Eine Aktionsleiste mit Buttons für schnelle Aktionen wurde in `hive_detail.html` hinzugefügt. |
| 18 | UX/UI | Die Ereignis-Anzeige auf der Detailseite (`hive_detail.html`) soll von einer Tabelle in einen chronologischen Feed umgewandelt werden. | Hoch | Erledigt | Die Detailseite eines Bienenstocks laden. | Alle Ereignisse werden als Feed von "Karten" mit Typ-Icons untereinander angezeigt. | Die Ereignis-Anzeige wurde in einen chronologischen Feed umgewandelt, der das `render_timeline_event`-Makro verwendet. |
| 19 | UX/UI | Das Layout der Startseite (`index.html`) soll von einer einfachen Liste in ein Card-Layout umgewandelt werden. | Mittel | Erledigt | Die Startseite laden. | Jeder Bienenstock wird als eigene "Karteikarte" mit den wichtigsten Stammdaten angezeigt. | Das Layout der Startseite wurde in ein Card-Layout umgewandelt, das das `render_hive_card`-Makro verwendet. |
| 20 | UX/UI | Auf den Bienenstock-Karten der Startseite soll eine "Zustands-Ampel" implementiert werden. | Mittel | Offen | Die Startseite laden. | Jede Karte zeigt eine farbliche Markierung (z.B. Grün, Gelb, Rot), die den Zustand des Volkes signalisiert. | Ein Platzhalter für die Zustands-Ampel ist vorhanden. Die Logik zur Bestimmung des Zustands muss noch implementiert werden. |
| 21 | UX/UI | Die Formulare sollen moderne Eingabeelemente (z.B. Sterne-Rating, Tags) erhalten, um die Dateneingabe zu vereinfachen. | Niedrig | Offen | Ein beliebiges Formular zur Dateneingabe öffnen (z.B. `new_inspection.html`). | Anstelle von reinen Textfeldern werden interaktive Elemente zur Bewertung und Auswahl verwendet. | Die Formulare wurden mit Bootstrap-Klassen optisch verbessert. Moderne Eingabeelemente erfordern JavaScript und sind noch nicht implementiert. |
| 22 | Performance / Usability | Die `hive_detail`-Seite lädt alle zugehörigen Daten (Inspektionen, Behandlungen etc.) auf einmal. Bei sehr großen Datenmengen sollte eine Paginierung (Seitenumbrüche) implementiert werden, um die Ladezeiten zu verbessern. | Niedrig | Offen | - | - | Dies ist eine zukünftige Performance-Optimierung für große Datenmengen. |
| 23 | Performance / Data Management | Der `update`-Vorgang im `data_manager` ist nicht für große Datenmengen optimiert. Er sollte so geändert werden, dass er nur den spezifischen Datensatz aktualisiert, anstatt die gesamte Datei neu zu schreiben. | Niedrig | Offen | - | - | Dies ist eine zukünftige Backend-Performance-Optimierung. |
| 24 | Internationalization | `Flask-Babel` zu `requirements.txt` hinzufügen und installieren. | Hoch | Erledigt | `pip install -r requirements.txt` ausführen. | `Flask-Babel` sollte erfolgreich installiert werden. | `Flask-Babel` wurde erfolgreich installiert. |
| 25 | Internationalization | Babel in `app/__init__.py` initialisieren und konfigurieren (unterstützte Sprachen: `['de', 'en', 'es', 'cs']`, Sprachauswahlfunktion). | Hoch | Erledigt | Anwendung starten und prüfen, ob Babel korrekt initialisiert ist. | Die Anwendung sollte ohne Fehler starten und die Babel-Konfiguration sollte aktiv sein. | Babel wurde in `app/__init__.py` initialisiert und konfiguriert. |
| 26 | Internationalization | Alle übersetzbaren Texte in `app/templates/*.html` mit `{{ _('...') }}` markieren. | Hoch | Erledigt | Alle HTML-Templates manuell prüfen. | Alle statischen Texte, die übersetzt werden sollen, sind korrekt markiert. | Alle relevanten HTML-Dateien wurden bearbeitet und die Texte mit `{{ _(...) }}` markiert. |
| 27 | Internationalization | Babel CLI verwenden, um Texte in eine `.pot`-Datei zu extrahieren. | Hoch | Erledigt | `pybabel extract -F babel.cfg -o messages.pot .` ausführen. | Eine `messages.pot`-Datei sollte mit allen markierten Texten erstellt werden. | Die `messages.pot`-Datei wurde erfolgreich erstellt. |
| 28 | Internationalization | `.po`-Dateien für jede unterstützte Sprache (Deutsch, Englisch, Spanisch, Tschechisch) generieren und Übersetzungen manuell eintragen. | Hoch | Offen | `pybabel init -i messages.pot -d translations -l de`, `pybabel init -i messages.pot -d translations -l en`, `pybabel init -i messages.pot -d translations -l es` und `pybabel init -i messages.pot -d translations -l cs` ausführen. | `de/LC_MESSAGES/messages.po`, `en/LC_MESSAGES/messages.po`, `es/LC_MESSAGES/messages.po` und `cs/LC_MESSAGES/messages.po` sollten erstellt werden und die Übersetzungen enthalten. | Die `.po`-Dateien für alle unterstützten Sprachen wurden generiert. Manuelle Übersetzung ist erforderlich. |
| 29 | Internationalization | `.po`-Dateien in `.mo`-Dateien kompilieren. | Hoch | Erledigt | `pybabel compile -d translations` ausführen. | `.mo`-Dateien sollten in den jeweiligen Sprachverzeichnissen erstellt werden. | Die `.po`-Dateien wurden erfolgreich in `.mo`-Dateien kompiliert. |
| 30 | Internationalization | Sprachauswahlmechanismus in `base.html` implementieren (z.B. Dropdown-Menü oder Links). | Hoch | Erledigt | `base.html` im Browser öffnen. | Ein funktionierendes Sprachauswahl-Element ist sichtbar. | Ein Dropdown-Menü zur Sprachauswahl wurde in `base.html` implementiert. |
| 31 | Internationalization | Logik zum Speichern der ausgewählten Sprache in der Benutzersitzung (Session/Cookie) implementieren. | Hoch | Erledigt | Sprache über die UI wechseln und prüfen, ob die Einstellung persistent ist. | Die ausgewählte Sprache bleibt beim Navigieren erhalten. | Die Logik zum Speichern der Sprache in der Session wurde in `app/__init__.py` implementiert. |
| 32 | UX/UI | Das Icon für die Aktion "Königin" war ein generisches Personensymbol. In der Chronik wurde für alle Ereignisse dasselbe Kalendersymbol anstelle des spezifischen Symbols für den Aktionstyp angezeigt. | Mittel | Erledigt | Die Detailseite eines Bienenstocks öffnen. Das Symbol auf dem "+ Königin"-Button und die Symbole für verschiedene Ereignistypen in der Chronik überprüfen. | Der "+ Königin"-Button sollte ein Edelstein-Symbol (`bi-gem`) haben. Die Chronik-Ereignisse sollten die gleichen Symbole wie die entsprechenden Aktions-Buttons anzeigen (z.B. Suche für Inspektion, Tropfen für Fütterung, Edelstein für Königin). | Das Symbol auf dem "+ Königin"-Button wurde in `bi-gem` geändert. Die Chronik verwendet nun einen sprachunabhängigen Schlüssel (`event_key`), um für jeden Ereignistyp das korrekte Symbol anzuzeigen, was die Funktionalität über alle Sprachen hinweg sicherstellt. |
| 33 | Refactoring / Quality | **Tracking-Issue:** Die Bezeichner (Labels) in allen `new_*`- und `edit_*`-Formularen sollen zentralisiert werden, um Inkonsistenzen und Internationalisierungsfehler zu beheben. <br> - [x] Feeding <br> - [x] Harvest <br> - [x] Hive <br> - [x] Inspection <br> - [x] Queen <br> - [x] Split <br> - [x] Treatment <br> - [x] Varroa Control | Mittel | Offen | - | - | - |
| 40 | Feature / Backend / Frontend | **Bild-Löschfunktion implementieren.** Benutzer sollen die Möglichkeit haben, einzelne hochgeladene Bilder von einem Datensatz zu entfernen. Dies erfordert eine UI-Option (z.B. ein Lösch-Button neben dem Thumbnail) und die entsprechende Backend-Logik, um die Datei vom Server zu löschen und den Dateipfad aus dem Datenmodell zu entfernen. | Hoch | Erledigt | 1. Ein Bild zu einer Aktion hochladen. <br> 2. Die Detailseite der Aktion aufrufen. <br> 3. Versuchen, das hochgeladene Bild zu löschen. <br> 4. Überprüfen, ob das Bild aus der Anzeige und dem Dateisystem entfernt wurde und der Datensatz aktualisiert ist. | Das Bild wird erfolgreich gelöscht und ist nicht mehr sichtbar oder im Dateisystem vorhanden. | Alle Schritte wurden erfolgreich durchgeführt. |
| 41 | Feature / UX/UI | **Bild-Vorschau (Lightbox/Modal) implementieren.** Beim Anklicken eines Bild-Thumbnails in der Chronik oder in den Bearbeitungsformularen soll sich eine größere, interaktive Ansicht des Bildes (z.B. in einer Lightbox oder einem Modal-Fenster) öffnen. | Mittel | Erledigt | 1. Navigieren zur Detailseite eines Bienenstocks mit Bildern. <br> 2. Auf ein Bild-Thumbnail klicken. <br> 3. Auf das 'X' oder neben das Bild klicken. | Das Bild wird in einer größeren Ansicht (Lightbox/Modal) geöffnet und lässt sich korrekt wieder schließen. Die Navigation der Seite wird nicht beeinträchtigt. | Die Implementierung einer reinen CSS-Lightbox erwies sich als komplex. Mehrere Iterationen waren nötig, um einen schwerwiegenden CSS-Bug zu beheben, bei dem die Lightbox standardmäßig sichtbar war (`display: flex` statt `display: none`). Die finale Lösung nutzt eine robuste HTML-Struktur (`div` statt `a` als Container) und eine korrekte, widerspruchsfreie CSS-Logik. Die Funktion wurde durch interaktive Tests mit dem Benutzer verifiziert und ist nun stabil. |
| 42 | Feature / Backend / Frontend / Error Handling | **Erweiterte Bild-Upload-Validierung und Fehler-Feedback.** Implementierung von client- und serverseitiger Validierung für hochgeladene Bilder (z.B. nur bestimmte Dateitypen wie JPG, PNG, GIF; maximale Dateigröße). Bei Validierungsfehlern sollen dem Benutzer klare, informative Fehlermeldungen angezeigt werden. | Hoch | Teilweise erledigt | 1. Versuchen, eine nicht-Bilddatei (z.B. `.txt`, `.pdf`) hochzuladen. <br> 2. Versuchen, eine sehr große Bilddatei (z.B. > 5MB) hochzuladen. <br> 3. Versuchen, eine ungültige oder beschädigte Bilddatei hochzuladen. | Die Anwendung lehnt den Upload ab und zeigt eine informative Fehlermeldung an, ohne abzustürzen. | **Testfall 1 (Nicht-Bilddatei):** Erfolgreich. Upload einer `.pdf`-Datei wurde mit der erwarteten Fehlermeldung "Invalid file type..." abgelehnt. <br> **Testfall 2 (Große Bilddatei):** Erfolgreich. Upload einer Datei > 5MB wurde mit "Request Entity Too Large" abgelehnt. <br> **Testfall 3 (Ungültige/beschädigte Bilddatei):** Nicht erfolgreich. Eine `.jpg`-Datei mit Textinhalt wurde akzeptiert. Die Anwendung führt derzeit keine Inhaltsprüfung durch, um die Integrität der Bilddatei zu validieren. Dies muss noch implementiert werden. |
| 43 | Performance / Backend | **Bild-Optimierung (Größenanpassung/Komprimierung) beim Upload.** Implementierung einer automatischen Größenanpassung und Komprimierung von Bildern direkt nach dem Upload, um den Speicherplatzbedarf zu reduzieren und die Ladezeiten der Anwendung zu verbessern. | Mittel | Offen | 1. Eine große Bilddatei hochladen. <br> 2. Die Größe der gespeicherten Datei im `uploads`-Verzeichnis überprüfen. | Die hochgeladene Bilddatei wird automatisch auf eine optimierte Größe und Qualität reduziert. | |
| 44 | Refactoring / Quality | **CSS-Struktur zentralisieren.** Um die Wartbarkeit und Konsistenz zu verbessern, wurden alle benutzerdefinierten CSS-Regeln aus den `<style>`-Tags der `base.html` in eine neue, zentrale CSS-Datei ausgelagert. | Hoch | Erledigt | Code-Review der `base.html` und der `static`-Verzeichnisstruktur. | Alle anwendungsspezifischen CSS-Regeln befinden sich in `app/static/css/style.css`. Die `base.html` enthält keine eingebetteten `<style>`-Blöcke mehr und verlinkt stattdessen auf die zentrale CSS-Datei. | Eine `style.css` wurde erstellt und alle Stile wurden erfolgreich migriert. Die `base.html` wurde entsprechend angepasst. Die CSS-Architektur ist nun sauber und zentralisiert. |

| 45 | Internationalization / Refactoring | **Template-Sprache auf Englisch standardisieren.** Um einen konsistenten und robusten Übersetzungsprozess mit Flask-Babel zu gewährleisten, müssen alle für den Benutzer sichtbaren Texte in den Jinja2-Templates von Deutsch auf Englisch umgestellt werden. Der englische Text dient als kanonischer Schlüssel (`msgid`) für alle Übersetzungen. <br> - [x] **Task 1:** Alle `*.html`-Dateien in `app/templates/` systematisch überprüfen. <br> - [x] **Task 2:** Alle deutschen Anzeigetexte identifizieren und ins Englische übersetzen. <br> - [x] **Task 3:** Die deutschen Texte in den Templates durch die neuen englischen, für die Übersetzung markierten Texte ersetzen. <br> - [x] **Task 4:** Den Übersetzungskatalog mit `pybabel extract` aktualisieren. <br> - [x] **Task 5:** Die `.po`-Dateien mit `pybabel update` aktualisieren. <br> - [x] **Task 6:** Die Übersetzungen mit `pybabel compile` kompilieren. <br> - [x] **Task 7:** Die deutschen Übersetzungen in der `de.po`-Datei überprüfen und vervollständigen. <br> **Checkliste der zu bearbeitenden Dateien:** <br> - [x] `_macros.html` <br> - [x] `404.html` <br> - [x] `base.html` <br> - [x] `edit_feeding.html` <br> - [x] `edit_harvest.html` <br> - [x] `edit_hive.html` <br> - [x] `edit_inspection.html` <br> - [x] `edit_queen.html` <br> - [x] `edit_split.html` <br> - [x] `edit_treatment.html` <br> - [x] `edit_varroa_control.html` <br> - [x] `feeding_list.html` <br> - [x] `harvests_list.html` <br> - [x] `harvests_report.html` <br> - [x] `hive_detail.html` <br> - [x] `index.html` <br> - [x] `inspections_list.html` <br> - [x] `new_feeding.html` <br> - [x] `new_harvest.html` <br> - [x] `new_hive.html` <br> - [x] `new_inspection.html` <br> - [x] `new_queen.html` <br> - [x] `new_split.html` <br> - [x] `new_treatment.html` <br> - [x] `new_varroa_control.html` <br> - [x] `queens_list.html` <br> - [x] `splits_list.html` <br> - [x] `treatments_list.html` <br> - [x] `treatments_report.html` <br> - [x] `varroa_controls_list.html` | Hoch | Erledigt | Die Anwendung nach Abschluss der Arbeiten mit Deutsch als ausgewählter Sprache testen. | Alle Oberflächentexte werden korrekt auf Deutsch angezeigt. Die `messages.pot`-Datei enthält nur englische Schlüssel. | |

# Aktuelle Probleme / Debugging

## Problem 1: Anwendung startet nicht im Docker-Container (Syntaxfehler in `docker-compose.yml`)

**Beobachtung:**
Die Anwendung startete nicht im Docker-Container. Die Fehlermeldung im Docker Desktop lautete:
```
bash: -c: line 0: syntax error near unexpected token `('
bash: -c: line 0: `pip install --no-cache-dir -r requirements.txt && gunicorn --bind 0.0.0.0:5000 app:create_app()'
```
Dies deutete darauf hin, dass die Bash-Shell im Docker-Container die Klammern `()` in `app:create_app()` als Syntaxfehler interpretierte, obwohl versucht wurde, sie zu maskieren.

**Analyse:**
Das Problem lag in der Art und Weise, wie `docker-compose` den `command`-String an die Shell im Container übergibt. Die ursprüngliche `command`-Zeile in `docker-compose.yml` führte dazu, dass `gunicorn` die `create_app()`-Funktion mit unerwarteten Argumenten aufrief. Dies wurde durch die `TypeError: create_app() takes 0 positional arguments but 2 were given` deutlich.

**Aktueller Stand der `docker-compose.yml`:**
```yaml
version: '3.8'

services:
  web:
    build: .
    ports:
      - "5000:5000"
    environment:
      SECRET_KEY: "your_secret_key_here"
    volumes:
      - .:/app
    command: bash -c "pip install --no-cache-dir -r requirements.txt && gunicorn --bind 0.0.0.0:5000 'app:create_app()'"
```

**Status:** Erledigt. Die `command`-Zeile wurde korrigiert, um `gunicorn` den korrekten Aufruf der `create_app()`-Funktion zu ermöglichen. Die Anwendung startet nun erfolgreich im Docker-Container.

## Problem 2: Anwendung startet nicht lokal (Jinja2 TemplateSyntaxError)

**Beobachtung:**
Beim lokalen Start der Anwendung über `venv` tritt ein `Internal Server Error` auf. Die Fehlermeldung im Terminal lautet:
```
jinja2.exceptions.TemplateSyntaxError: expected token ':', got 'Inspection'
```
Dieser Fehler tritt in `app/templates/_macros.html` in der Zeile auf, die das `icon_map`-Wörterbuch definiert.

**Analyse:**
Der Fehler entsteht, weil die `_()`-Funktion (`{{ _('Inspection') }}`) innerhalb der Schlüssel des `icon_map`-Wörterbuchs verwendet wurde. Jinja2 versucht, diese Ausdrücke zur Kompilierungszeit als Teil der Wörterbuchschlüssel zu interpretieren, was zu einem Syntaxfehler führt. Jinja2 kann zur Kompilierungszeit keine Python-Funktionen wie `_()` ausführen, um den Schlüssel zu bestimmen. Die Schlüssel in einem Jinja2-`set`-Statement müssen statische Strings oder einfache Variablen sein.

**Aktueller Stand der `_macros.html`:**
Die `_macros.html` wurde zuletzt korrigiert, indem die `_()`-Funktion aus den Schlüsseln des `icon_map`-Wörterbuchs entfernt wurde. Die Schlüssel sollten nun die originalen, untranslatierten Strings sein.

## Problem 3: Internationalisierung funktioniert nicht in venv-Umgebung

**Beobachtung:**
Die Anwendung zeigt trotz korrekter Sprachauswahl in der Session und kompilierten `.mo`-Dateien ausschließlich englischen Text an.

**Analyse:**
Die Sprachauswahl in der Session funktioniert korrekt, wie die Terminalausgaben zeigen. Das Problem liegt nicht in der Sprachauswahl selbst, sondern in der Anwendung der Übersetzungen in den Templates. Es wurde festgestellt, dass die Flask-Anwendung die `translations`-Ordner nicht korrekt findet oder lädt, oder dass die Jinja2-Umgebung die Übersetzungen nicht korrekt anwendet.

**Lösung:**
Der `BABEL_TRANSLATION_DIRECTORIES` wurde in `app/__init__.py` explizit auf den Pfad zum `translations`-Ordner gesetzt. Dies stellt sicher, dass Flask-Babel die Übersetzungsdateien korrekt findet und lädt. Zusätzlich wurde die doppelte Definition der `create_app()`-Funktion in `app/__init__.py` entfernt, was ein kritischer Fehler war.

**Aktueller Stand:**
Die Internationalisierung funktioniert nun wie erwartet.

**Nächste Schritte zur Fehlerbehebung:**

1.  **Docker-Problem (Problem 1):**
    *   Überprüfen, ob die `docker-compose.yml` nach der letzten Änderung korrekt gespeichert wurde.
    *   Erneut `docker-compose up --build -d` ausführen und die Logs genau beobachten. Es ist möglich, dass es ein Caching-Problem gab oder die Änderung nicht vollständig übernommen wurde.
    *   Sollte der Fehler weiterhin bestehen, müsste man tiefer in die Docker-Umgebung eintauchen, um zu sehen, wie der Befehl tatsächlich ausgeführt wird (z.B. mit `docker exec -it <container_id> bash` und den Befehl manuell ausführen).

2.  **Lokales Problem (Problem 2):**
    *   Da die `_macros.html` bereits korrigiert wurde, sollte dieser Fehler beim nächsten lokalen Start nicht mehr auftreten. Es ist wichtig, sicherzustellen, dass die Änderungen in der Datei auch tatsächlich gespeichert wurden.
    *   Erneut lokal starten und prüfen, ob der Fehler behoben ist.

**Zusammenfassung des aktuellen Zustands:**
Die Internationalisierung wurde in den Templates und der `app/__init__.py` implementiert. Die `.po`- und `.mo`-Dateien wurden generiert. Die Anwendung kann jedoch aufgrund der oben genannten Probleme weder lokal noch im Docker-Container gestartet werden. Die Behebung dieser Startprobleme ist der nächste kritische Schritt, um die Internationalisierung zu testen.

## Problem 4: "Variety:" für Honigart wird nicht übersetzt

**Beobachtung:**
Auf der Detailseite eines Bienenvolkes wird in der Anzeige für die Aktion "Ernte" die Bezeichnung für die Honigart immer als "Variety:" angezeigt, unabhängig von der eingestellten Sprache.

**Analyse:**
Die Zeichenkette "Variety:" in `app/templates/_macros.html` war nicht für die Übersetzung markiert (`_()`). Zudem wurde entschieden, die Bezeichnung aus Konsistenzgründen auf "Honey Type:" zu ändern, da diese Vokabel auch im Formular zur Erstellung eines Ernte-Datensatzes verwendet wird.

**Lösung:**
Die Zeichenkette "Variety:" in `app/templates/_macros.html` wurde durch `{{ _('Honey Type') }}` ersetzt. Anschließend wurden die Babel-Übersetzungsdateien (messages.pot, .po, .mo) aktualisiert und neu kompiliert, um die neue übersetzbare Zeichenkette zu integrieren.

**Aktueller Stand:**
Die Bezeichnung für die Honigart wird nun als "Honey Type:" angezeigt und korrekt übersetzt.

## Problem 5: App-Absturz beim Aufruf der Bienenstock-Detailseite (NameError)

**Beobachtung:**
Beim Klick auf die Detailseite eines Bienenvolks stürzte die Anwendung mit einem `Internal Server Error` ab. Das Terminal zeigte einen `NameError: name '_' is not defined`, der auf die Datei `app/routes.py` in der Funktion `hive_detail` zurückzuführen war.

**Analyse:**
Der Fehler wurde durch den Versuch verursacht, die Übersetzungsfunktion `_()` direkt im Python-Code zu verwenden, ohne sie zu importieren. Die Zeile `event.type = _('Inspektion')` und ähnliche Zuweisungen waren fehlerhaft. Ein einfacher Import der Funktion `_` wäre hier nicht die korrekte Lösung gewesen, da dies den Ereignistyp für alle Einträge fälschlicherweise auf einen hartcodierten, deutschen Begriff gesetzt hätte. Der korrekte, bereits im Projekt etablierte Ansatz ist die Verwendung eines sprachunabhängigen `event_key`, der erst im Jinja2-Template für die Übersetzung und Anzeige verwendet wird.

**Lösung:**
Die Funktion `hive_detail` in `app/routes.py` wurde korrigiert. Alle Zuweisungen an `event.type` wurden entfernt. Stattdessen wird nun konsistent nur noch der `event.event_key` (z.B. `event.event_key = 'inspection'`) für jeden Ereignistyp gesetzt. Dies behebt den `NameError` und stellt sicher, dass die Chronik-Logik korrekt funktioniert und die Übersetzung wie vorgesehen im Template stattfindet.

**Status:** Erledigt.
